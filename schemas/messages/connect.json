{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://taips.tap.rsvp/schemas/messages/connect.json",
  "title": "Connect Message",
  "description": "Requests a connection between agents with specified constraints as per TAIP-15",
  "type": "object",
  "allOf": [
    {
      "$ref": "../common/didcomm-base.json#/$defs/didcommHeader"
    }
  ],
  "properties": {
    "type": {
      "const": "https://tap.rsvp/schema/1.0#Connect"
    },
    "body": {
      "type": "object",
      "required": ["@context", "@type", "requester", "principal", "agents", "constraints"],
      "properties": {
        "@context": {
          "const": "https://tap.rsvp/schema/1.0",
          "description": "JSON-LD context for TAP messages"
        },
        "@type": {
          "const": "Connect",
          "description": "TAP message type identifier"
        },
        "requester": {
          "$ref": "../data-structures/party.json",
          "description": "Party requesting the connection"
        },
        "principal": {
          "$ref": "../data-structures/party.json",
          "description": "Party the requesting agent acts on behalf of"
        },
        "agents": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "../data-structures/agent.json"
          },
          "description": "Array of agents involved in the connection process. At minimum, one agent must match the from field of the DIDComm message and have a for attribute set to the requester DID"
        },
        "constraints": {
          "$ref": "../data-structures/transaction-constraints.json",
          "description": "Transaction constraints including limits and allowed purposes"
        },
        "expiry": {
          "$ref": "../common/base-types.json#/$defs/ISO8601DateTime",
          "description": "Optional expiration timestamp for the connection request"
        },
        "agreement": {
          "type": "string",
          "format": "uri",
          "description": "Optional URL pointing to terms of service or agreement"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["type", "body"]
}